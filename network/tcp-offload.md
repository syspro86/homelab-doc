# MTU

네트워크 장치가 한번에 전송할 수 있는 패킷 크기. 보통 1500바이트 혹은 점보프레임 지원시 9000바이트. TCP,IP 프로토콜 헤더가 각각 20바이트로 TCP/IP 본문을 한번에 1460 바이트 전송할 수 있다.

# IP 계층 패킷 분할

IP 계층에서 MTU 이상 패킷을 자동으로 쪼갠 후, 받은 곳에서 합치는 기능인데 서로 다른 MTU 를 가진 여러 네트워크 장비를 거치면 분할이 반복되며 효율이 좋지 않다.

Dont Fragment 세팅 시 MTU 보다 큰 패킷을 보내면 실패하기 때문에, 이를 통해 큰 패킷부터 보내면서 최적의 MTU 값을 찾는다고 한다.

# TCP 계층 패킷 분할

## LSO (Large Send Offload), TSO (TCP Segmentation Offload)
마찬가지로 MTU 단위로 쪼개는데 tcp offload engine 라는 NIC 기능을 통해 성능 이점을 얻는다.

큰 패킷을 NIC로 전달하면 하드웨어 레벨에서 패킷을 분할 전송하여, CPU 부담을 줄인다.

## LRO(Large Receive Offload) GRO(Generic Receive Offload)

반대로 분할된 패킷을 받아 하나의 대량 패킷 수신으로 전달해주는 기능이다. (커널이나 프로그램에)

이런 패킷 분할은 각 종단 단말에서의 패킷 캡쳐로는 확인이 불가하다. 패킷 캡쳐 이후 분할되고, 패킷이 합쳐진 이후 캡쳐되기 떄문이다.

위 옵션들이 적용 되었는지는 ethtool -k dev 로 옵션 확인 가능하다.

LSO, TSO, LRO, GRO 이 없어도 패킷 분할은 되어야 하며, 이 작업을 하드웨어에 큰 버퍼를 통으로 넘겨 시스템콜을 줄이는 목적이다. (성능 향상)

LRO (하드웨어 드라이버 혹 커널) 는 패킷을 합칠때 헤더가 뭉개지는데 GRO (커널내 존재) 는 이를 해결하며 TCP/IP 외에도 적용된다고 한다.
